(function(){"use strict";function r(t,e,s,n,o,p,u,f){var i=typeof t=="function"?t.options:t;return e&&(i.render=e,i.staticRenderFns=s,i._compiled=!0),{exports:t,options:i}}const l={props:{comments:{type:Array,required:!0},translations:{type:Object,required:!0}},data(){return{loading:!1,filterMode:""}},computed:{filterOptions(){return[{value:"open",text:this.translations.filter_open},{value:"resolved",text:this.translations.filter_resolved}]},filteredComments(){return this.filterMode==="open"?this.comments.filter(t=>t.comment.status==="OPEN"):this.filterMode==="resolved"?this.comments.filter(t=>t.comment.status==="RESOLVED"):this.comments},emptyStateMessage(){return this.filterMode==="open"?this.translations.empty_no_open:this.filterMode==="resolved"?this.translations.empty_no_resolved:this.translations.empty_no_comments}},methods:{commentOptions(t){const e=[];return t.preview&&e.push({icon:"open",title:this.translations.action_open_page,click:()=>window.open(t.preview,"_blank")}),t.comment.status==="RESOLVED"?e.push({icon:"check",title:this.translations.action_reopen,theme:"green",click:()=>this.toggleResolve(t.comment.id,t.comment.status)}):e.push({icon:"circle",title:this.translations.action_resolve,click:()=>this.toggleResolve(t.comment.id,t.comment.status)}),e.push({icon:"trash",title:this.translations.action_delete,theme:"red",click:()=>this.deleteComment(t.comment.id)}),e},onFilterChange(t){this.filterMode=t},async toggleResolve(t,e){const s=e==="RESOLVED"?"OPEN":"RESOLVED",n=s==="RESOLVED"?this.translations.message_resolved:this.translations.message_reopened;this.loading=!0;try{let o;if(s==="RESOLVED"?o=await this.$api.post("loop/comment/resolve",{id:t}):o=await this.$api.post("loop/comment/unresolve",{id:t}),o&&(o.success||o.status==="ok"))this.$panel.notification.success(n),this.$reload();else throw new Error("API returned unsuccessful response")}catch(o){console.error("Failed to toggle comment status:",o),this.$panel.notification.error("Failed to update comment")}finally{this.loading=!1}},async deleteComment(t){this.loading=!0;try{const e=await this.$api.delete(`loop/panel/comment/${t}`);if(e&&(e.success||e.status==="ok"))this.$panel.notification.success(this.translations.message_deleted),this.$reload();else throw new Error("API returned unsuccessful response")}catch(e){console.error("Failed to delete comment:",e),this.$panel.notification.error("Failed to delete comment")}finally{this.loading=!1}}}};var a=function(){var e=this,s=e._self._c;return s("k-panel-inside",{staticClass:"k-loop-view"},[s("k-header",[e._v(" "+e._s(e.translations.title)+" ")]),s("div",{staticClass:"k-loop-filter"},[s("k-select-field",{staticClass:"k-loop-filter__select",attrs:{label:e.translations.filter_label,options:e.filterOptions,value:e.filterMode,placeholder:e.translations.filter_placeholder},on:{input:e.onFilterChange}})],1),s("k-section",{attrs:{headline:e.translations.comments}},[e.loading?s("k-empty",{attrs:{icon:"loader"}},[e._v(e._s(e.translations.loading))]):e.filteredComments.length?[s("k-items",{attrs:{items:e.filteredComments,layout:"list"},scopedSlots:e._u([{key:"default",fn:function({item:n}){return[s("k-item",{attrs:{text:n.text,info:n.info,buttons:e.commentOptions(n)}})]}}])})]:s("k-empty",{attrs:{icon:"check"}},[e._v(e._s(e.emptyStateMessage))])],2)],1)},c=[],d=r(l,a,c);const m=d.exports;window.panel.plugin("moinframe/kirby-loop",{components:{"k-loop-view":m}})})();
